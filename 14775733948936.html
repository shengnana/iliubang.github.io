<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
    
  åŸºäºCè¯­è¨€çš„ç¼–ç¨‹è¯­è¨€å¼€å‘ -- yacc/lexåˆæ­¥ - åˆ˜é‚¦çš„åšå®¢
  
  </title>
  
  
  <link href="atom.xml" rel="alternate" title="åˆ˜é‚¦çš„åšå®¢" type="application/atom+xml">
    <link rel="stylesheet" href="asset/css/foundation.min.css" />
    <link rel="stylesheet" href="asset/css/docs.css" />
    <script src="asset/js/vendor/modernizr.js"></script>
    <script src="asset/js/vendor/jquery.js"></script>
  <script src="asset/highlightjs/highlight.pack.js"></script>
  <link href="asset/highlightjs/styles/github.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script>hljs.initHighlightingOnLoad();</script>
<script type="text/javascript">
  function before_search(){
    var searchVal = 'site:iliubang.github.io ' + document.getElementById('search_input').value;
    document.getElementById('search_q').value = searchVal;
    return true;
  }
</script>
  </head>
  <body class="antialiased hide-extras">
    
    <div class="marketing off-canvas-wrap" data-offcanvas>
      <div class="inner-wrap">


<nav class="top-bar docs-bar hide-for-small" data-topbar>


  <section class="top-bar-section">
  <div class="row">
      <div style="position: relative;width:100%;"><div style="position: absolute; width:100%;">
        <ul id="main-menu" class="left">
        
        <li id=""><a target="_self" href="index.html">Home</a></li>
        
        <li id=""><a target="_self" href="archives.html">Archives</a></li>
        
        <li id=""><a target="_blank" href="https://github.com/iliubang">About</a></li>
        
        </ul>

        <ul class="right" id="search-wrap">
          <li>
<form target="_blank" onsubmit="return before_search();" action="http://google.com/search" method="get">
    <input type="hidden" id="search_q" name="q" value="" />
    <input tabindex="1" type="search" id="search_input"  placeholder="Search"/>
</form>
</li>
          </ul>
      </div></div>
  </div>
  </section>

</nav>

        <nav class="tab-bar show-for-small">
  <a href="javascript:void(0)" class="left-off-canvas-toggle menu-icon">
    <span> &nbsp; åˆ˜é‚¦çš„åšå®¢</span>
  </a>
</nav>

<aside class="left-off-canvas-menu">
      <ul class="off-canvas-list">
       
       <li><a href="index.html">HOME</a></li>
    <li><a href="archives.html">Archives</a></li>
    <li><a href="about.html">ABOUT</a></li>

    <li><label>Categories</label></li>

        
            <li><a href="PHP.html">PHP</a></li>
        
            <li><a href="OS.html">OS</a></li>
        
            <li><a href="C.html">C</a></li>
        
            <li><a href="Java.html">Java</a></li>
         

      </ul>
    </aside>

<a class="exit-off-canvas" href="#"></a>


        <section id="main-content" role="main" class="scroll-container">
        
       

 <script type="text/javascript">
  $(function(){
    $('#menu_item_index').addClass('is_active');
  });
</script>
<div class="row">
  <div class="large-8 medium-8 columns">
      <div class="markdown-body article-wrap">
       <div class="article">
          
          <h1>åŸºäºCè¯­è¨€çš„ç¼–ç¨‹è¯­è¨€å¼€å‘ -- yacc/lexåˆæ­¥</h1>
     
        <div class="read-more clearfix">
          <span class="date">2016/10/27 21:3 ä¸‹åˆ</span>

          <span>posted in&nbsp;</span> 
          
              <span class="posted-in"><a href='C.html'>C</a></span>
           
         
          <span class="comments">
            

            
          </span>

        </div>
      </div><!-- article -->

      <div class="article-content">
      <h2 id="toc_0">Preface</h2>

<p>å½“ä»Šä¸–é“ï¼Œå„ç§é«˜çº§è¯­è¨€ç™¾èŠ±é½æ”¾ã€‚ç„¶è€Œä¼šæœ‰äººå‘å‡ºè¿™æ ·çš„ç–‘é—®--è®¡ç®—æœºçœŸçš„èƒ½å¤Ÿè¯†åˆ«è¿™ä¹ˆå¤šè¯­è¨€å—ï¼Ÿç¨å¾®æœ‰ç‚¹å¸¸è¯†çš„äººéƒ½çŸ¥é“ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸å¯èƒ½æ»´ï¼åœ¨è®¡ç®—æœºçš„ä¸–ç•Œé‡Œï¼Œä»–ä»¬èƒ½å¤Ÿç›´æ¥è¯†åˆ«çš„åªæœ‰æœºå™¨è¯­è¨€ã€‚ç„¶è€Œï¼Œç”±äºæœºå™¨è¯­è¨€å¯¹äººç±»ä¸å¤Ÿå‹å¥½ï¼Œæ‰€ä»¥äººä»¬æ‰å‘æ˜äº†æ±‡ç¼–ï¼Œcï¼ŒJava...è®¸è®¸å¤šå¤šçš„äººç±»æ˜“è¯»çš„ç¼–ç¨‹è¯­è¨€ï¼Œæ‰€ä»¥æˆ‘ä¸ªäººå¯¹ç¼–ç¨‹è¯­è¨€çš„ç†è§£ä¸€ç›´æ˜¯å…¶å®ä»–ä»¬å°±æ˜¯æœºå™¨è¯­è¨€çš„è¯­æ³•ç³–ï¼Œè€Œç¼–ç¨‹è¯­è¨€çš„åˆ›é€ è¿‡ç¨‹ï¼Œå°±æ˜¯å®šä¹‰ä¸€ç§åˆç†çš„ï¼Œæ²¡æœ‰äºŒä¹‰æ€§çš„è¯­æ³•è§„åˆ™ï¼Œç„¶åå°±æ˜¯é€šè¿‡ç›´æ¥æˆ–é—´æ¥çš„æ–¹å¼å®ç°è¯¥è¯­æ³•åˆ°æœºå™¨è¯­è¨€çš„è½¬æ¢è¿‡ç¨‹ã€‚æ—¢ç„¶æ˜¯è¿™æ ·çš„è¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¾ˆå®¹æ˜“æƒ³åˆ°ï¼Œè®¡ç®—æœºè¯­è¨€æ˜¯ä¸€ä¸ªè‡ªæˆ‘å®Œå–„çš„è¿‡ç¨‹ï¼šé¦–å…ˆæˆ‘ä»¬å®šäº†ä¸€ç§éå¸¸ç®€å•çš„x1(è¿™é‡Œåªæ˜¯ç”¨æ¥ä¸¾ä¾‹è¯´æ˜ï¼Œæœ‰æ²¡æœ‰xè¯­è¨€æœ‰å¾…è€ƒè¯)è¯­è¨€ï¼Œç„¶åç”¨æœºå™¨è¯­è¨€å®ç°äº†è¿™ä¸ªéå¸¸ç®€å•çš„x1è¯­è¨€çš„ç¼–è¯‘å™¨ï¼Œåˆ›é€ äº†x1è¯­è¨€ï¼Œå®ç°äº†éå¸¸ç®€å•çš„æ–°ç‰¹æ€§ï¼Œç„¶åæˆ‘ä»¬å†ç”¨x1è¯­è¨€(ç›¸å¯¹äºæœºå™¨è¯­è¨€è¾ƒé«˜çº§)å®ç°äº†å¦ä¸€äº›æ–°çš„ç‰¹æ€§çš„x2è¯­è¨€çš„ç¼–è¯‘å™¨ï¼Œåˆ›é€ äº†x2è¯­è¨€ï¼Œ...ï¼Œå¦‚æ­¤ä¸‹å»ï¼Œäººä»¬åˆ›é€ äº†æ±‡ç¼–è¯­è¨€ï¼Œä»è€Œåˆ›é€ äº†cè¯­è¨€ï¼Œæ¥ç€åˆ›é€ äº†ä¸–ç•Œä¸Šæœ€å¥½çš„è¯­è¨€PHP(ä¸çŸ¥é“æ˜¯ä¸æ˜¯çœŸçš„ï¼Œåæ­£å¤§å®¶éƒ½ä¹ æƒ¯è¿™ä¹ˆè¯´)ã€‚<br/>
åœ¨å„ç§é«˜çº§è¯­è¨€è¶Šæ¥è¶Šå¼ºå¤§çš„ä»Šå¤©ï¼Œæˆ‘ä»¬å¯èƒ½å¾ˆéš¾å†ä¼šå»æ¥è§¦æœ€åŸå§‹çš„ä¸œè¥¿ï¼Œé«˜åº¦å°è£…ç¡®å®æé«˜äº†ç”Ÿäº§åŠ›ï¼Œé™ä½äº†å­¦ä¹ æˆæœ¬ï¼Œä½†æ˜¯ä¹Ÿä½¿å¾—ç°ä»£ç¨‹åºå‘˜å°†å¤ªå¤šç²¾åŠ›èŠ±åœ¨äº†å„ç§è¯´æ˜ä¹¦ä¸Šï¼Œè€Œä¸æ¸…æ¥šå…¶æœ¬è´¨ã€‚<br/>
æ¯•ä¸šä¸€å¹´å¤šï¼Œå·¥ä½œäº†ä¸€å¹´å¤šï¼Œå¯¹äºè®¡ç®—æœºç¼–ç¨‹æœ‰äº†è‡ªå·±çš„çœ‹æ³•ï¼Œä¸å†åƒåœ¨å¤§å­¦çš„æ—¶å€™è®¤è¯†çš„é‚£æ ·è‚¤æµ…ï¼Œåè€Œè§‰å¾—å¤§å­¦ä¸­å­¦ä¹ çš„çŸ¥è¯†æ‰æ˜¯çœŸæ­£çš„å¹²è´§ï¼Œä¸ç¦æ„Ÿå¹æ›¾ç»æµªè´¹æ‰äº†å¤§å¥½å…‰é˜´ã€‚å¥½åœ¨é™¶æ¸Šæ˜æœ‰è¯äº‘ï¼šâ€œæ‚Ÿå·²å¾€ä¹‹ä¸è°ï¼ŒçŸ¥æ¥è€…ä¹‹å¯è¿½â€ã€‚<br/>
é—²æš‡ä¹‹ä½™ï¼Œæ‰’å¼€PHP(è¿™é‡Œä¹‹æ‰€ä»¥æ˜¯PHPå¹¶ä¸å› ä¸ºä»–æ˜¯ä¸–ç•Œä¸Šæœ€å¥½çš„è¯­è¨€ï¼Œåªæ˜¯å› ä¸ºæˆ‘ç›®å‰ä»äº‹çš„æ˜¯PHPå¼€å‘çš„å·¥ä½œè€Œå·²)æºç ï¼Œäº†è§£äº†å…¶å†…éƒ¨æ„é€ å’Œå®ç°åŸç†ï¼Œç™¾çœ‹ä¸ä¸€ç»ƒã€‚ä»Šå¤©å°±åˆæ­¥å­¦ä¹ yacc/lexäº†ï¼Œè®°å½•åœ¨æˆ‘çš„åšå®¢ä¸­ï¼Œä»¥ä¾¿ä»¥åç¿»é˜…å·©å›ºã€‚</p>

<h2 id="toc_1">è¿‡ç¨‹ç®€è¿°</h2>

<p>ä¸€èˆ¬æ¥è¯´ç¼–ç¨‹è¯­è¨€çš„è§£é‡Šæ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š</p>

<p><strong>ONE</strong>. è¯æ³•åˆ†æ<br/>
å°†æºä»£ç æ‹†åˆ†æˆè‹¥å¹²Tokençš„è¿‡ç¨‹</p>

<p><strong>TWO</strong>.è¯­æ³•åˆ†æ<br/>
å°†Tokenæ„å»ºæˆSyntax Treeçš„è¿‡ç¨‹</p>

<p><strong>THREE</strong>.ç”Ÿæˆæ‰§è¡Œç <br/>
ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶</p>

<h2 id="toc_2">yaccï¼ˆYet Another Compiler Compilerï¼‰</h2>

<p>ä¸‹é¢æ˜¯wikipediaä¸­å¯¹yaccçš„æè¿°</p>

<blockquote>
<p>Yacc is a computer program for the Unix operating system. It is a Look Ahead Left-to-Right (LALR) parser generator, generating a parser, the part of a compiler that tries to make syntactic sense of the source code, specifically a LALR parser, based on an analytic grammar written in a notation similar to Backusâ€“Naur Form (BNF). Yacc itself used to be available as the default parser generator on most Unix systems, though it has since been supplanted as the default by more recent, largely compatible, programs.</p>
</blockquote>

<p>å…¶å®‰è£…éå¸¸ç®€å•</p>

<pre><code class="language-bash">sudo apt-get install bison
</code></pre>

<h2 id="toc_3">lex/flex</h2>

<p>lex æ˜¯ä¸€ä¸ªç”Ÿæˆè¯æ³•åˆ†æå™¨çš„å·¥å…·ã€‚Lexè¯»è¿›ä¸€ä¸ªä»£è¡¨è¯æ³•åˆ†æå™¨è§„åˆ™çš„è¾“å…¥å­—ç¬¦ä¸²æµï¼Œç„¶åè¾“å‡ºä»¥Cè¯­è¨€å®åšçš„è¯æ³•åˆ†æå™¨æºä»£ç ã€‚ä¼ ç»Ÿä¸Šï¼Œlexå±äºå•†ä¸šè½¯ä»¶ï¼Œä½†æ˜¯æœ‰äº›æ ¹æ®åŸæœ¬AT&amp;Tä»£ç è¿™äº›ç‰ˆæœ¬çš„Lexå¯ä»¥ä»¥å…¬å¼€æºä»£ç çš„å½¢å¼è·å¾—ï¼Œå¹¶è¢«è§†ä¸ºæŸäº›ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†ï¼Œä¾‹å¦‚è¯´OpenSolariså’Œè´å°”å®éªŒå®¤ä¹å·é¡¹ç›®ã€‚å¦ä¸€ä¸ªæœ‰åçš„Lexå…¬å¼€æºä»£ç ç‰ˆæœ¬æ˜¯flexï¼Œä»£è¡¨&quot;å¿«é€Ÿçš„è¯æ³•åˆ†æå™¨&quot;ï¼ˆfast lexical analyzerï¼‰</p>

<p>åœ¨linuxä¸‹å®‰è£…</p>

<pre><code class="language-bash">sudo apt-get install flex
</code></pre>

<h2 id="toc_4">practice</h2>

<ul>
<li>å®ç°ä¸€ä¸ªç®€å•çš„è®¡ç®—ç¨‹åº</li>
</ul>

<p>é¦–å…ˆå®šä¹‰lexè§„åˆ™ï¼Œå…¶æ‰©å±•åä¸º<code>.l</code>ï¼Œåœ¨lexä¸­å¯ä»¥å¾ˆå®¹æ˜“è¯»æ‡‚å…¶å®šä¹‰çš„è§„åˆ™ï¼Œå› ä¸ºä»–ç”¨åˆ°çš„æ˜¯æ­£åˆ™è¡¨è¾¾å¼ã€‚</p>

<pre><code class="language-c">%{
/*
 |------------------------------------------------------------------
 | linger test
 |------------------------------------------------------------------
 | @author    : liubang
 | @date      : 16/10/27 ä¸‹åˆ8:28
 | @copyright : (c) iliubang.cn
 | @license   : MIT (http://opensource.org/licenses/MIT)
 |------------------------------------------------------------------
 */

#include &lt;stdio.h&gt;
#include &quot;y.tab.h&quot;

int yywrap(void)
{
    return 1;
}
%}

%%

&quot;+&quot;     return ADD;
&quot;-&quot;     return SUB;
&quot;*&quot;     return MUL;
&quot;/&quot;     return DIV;
&quot;\n&quot;        return CR;

([1-9][0-9]*)|0|([0-9]+\.[0-9]+) {
    double d;
    sscanf(yytext, &quot;%lf&quot;, &amp;d);
    yylval.double_value = d;
    return DOUBLE_LITERAL;
}

[ \t] ;
. {
    fprintf(stderr, &quot;lexical error.\n&quot;);
    exit(1);
}
%%

</code></pre>

<p>å¯ä»¥çœ‹åˆ°ä»¥ä¸Šçš„ä»£ç ä¸»è¦åŒ…å«ä¸¤éƒ¨åˆ†ï¼Œ<code>%{</code> <code>%}</code>åŒ…å«çš„éƒ¨åˆ†å’Œ<code>%%</code> <code>%%</code>åŒ…å«çš„éƒ¨åˆ†ã€‚å‰ä¸€éƒ¨åˆ†å«<strong>å®šä¹‰åŒºå—</strong>, åè€…æ˜¯<strong>è§„åˆ™åŒºå—</strong>ï¼Œå®šä¹‰åŒºå—å†…çš„ä»£ç å°†ä¼šè¢«åŸæ ·è¾“å‡ºï¼Œåœ¨å®šä¹‰åŒºå—ä¸­<code>#include &quot;y.tab.h&quot;</code>å°†ä¼šåœ¨yaccç¼–è¯‘å…¶è§„åˆ™æ–‡ä»¶åè‡ªåŠ¨ç”Ÿæˆï¼Œ<code>ADD</code> <code>SUB</code> <code>MUL</code> <code>DIV</code> <code>CR</code> <code>DOUBLE_LITERAL</code>ç­‰éƒ½æ˜¯åœ¨y.tab.hä¸­å®šä¹‰çš„macroã€‚<br/>
åœ¨å®šä¹‰åŒºå—ä¸­ï¼Œæœ‰ä¸€ä¸ªåä¸º<code>yywrap</code>çš„functionï¼Œå…¶ä½œç”¨æ˜¯è‡ªåŠ¨link lexçš„åº“æ–‡ä»¶ã€‚<br/>
è‡³äºè§„åˆ™åŒºå—ï¼Œå­¦è¿‡æ­£åˆ™è¡¨è¾¾å¼çš„äººä¸€çœ‹å°±ä¼šæ˜ç™½ï¼Œå…¶ä½œç”¨å°±æ˜¯ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥æè¿°Tokenã€‚è§„åˆ™åŒºå—çš„å®šä¹‰ä¸ºï¼šæ­£åˆ™è¡¨è¾¾å¼ï¼Œåè¾¹è·Ÿä¸ŠCä»£ç ï¼Œè¿™äº›ä»£ç ç”¨<code>{}</code>æ‹¬èµ·æ¥ï¼Œè¯»å…¥çš„å­—ç¬¦æµæ»¡è¶³äº†æ­£åˆ™ï¼Œåˆ™æ‰§è¡Œå…¶åçš„ä»£ç ï¼ŒåŒ¹é…åˆ°çš„åŸå­—ç¬¦è¢«ä¿å­˜åœ¨<code>yytext</code>è¿™ä¸ªå…¨å±€å˜é‡ä¸­ã€‚</p>

<p>æ¥ç€æ¥ç¼–å†™yaccçš„è§„åˆ™ï¼Œå…¶æ‰©å±•åä¸º<code>.y</code>ã€‚</p>

<pre><code class="language-c">%{
/*
 |------------------------------------------------------------------
 | linger test
 |------------------------------------------------------------------
 | @author    : liubang
 | @date      : 16/10/27 ä¸‹åˆ8:43
 | @copyright : (c) iliubang.cn
 | @license   : MIT (http://opensource.org/licenses/MIT)
 |------------------------------------------------------------------
 */

#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#define YYDEBUG 1

%}

%union {
    int int_value;
    double  double_value;
}

%token &lt;double_value&gt;       DOUBLE_LITERAL
%token ADD SUB MUL DIV CR
%type &lt;double_value&gt; expression term primary_expression

%%

line_list
    : line
    | line_list line
;
line
    : expression CR
    {
        printf(&quot;&gt;&gt;%lf\n&quot;, $1);
    }
;
expression
    : term
    | expression ADD term
    {
        $$ = $1 + $3;
    }
    | expression SUB term
    {
        $$ = $1 - $3;
    }
;
term
    : primary_expression
    | term MUL primary_expression
    {
        $$ = $1 * $3;
    }
    | term DIV primary_expression
    {
        $$ = $1 / $3;
    }
;
primary_expression
    : DOUBLE_LITERAL
;

%%

int yyerror(char const *str)
{
    extern char *yytext;
    fprintf(stderr, &quot;syntax error near %s\n&quot;, yytext);
    return 0;
}

int main(void)
{
    extern int yyparse(void);
    extern FILE *yyin;

    yyin = stdin;
    if (yyparse()) {
        fprintf(stderr, &quot;Core Dump!\n&quot;);
        exit(1);
    }
}
</code></pre>

<p>yaccè§„åˆ™å®šä¹‰è·Ÿlexç›¸ä¼¼ï¼Œéƒ½ç”¨åˆ°äº†<code>%{%}</code> <code>%%</code>æ¥åŒ…å«ä»£ç å—ã€‚<br/>
åŒæ ·çš„æ˜¯<code>%{%}</code>åŒ…è£¹çš„ä»£ç å°†è¢«åŸæ ·è¾“å‡ºã€‚<br/>
åœ¨<code>%union</code>å®šä¹‰ä¸­ï¼Œå£°æ˜äº†è®°å·å’Œéç»ˆç»“ç¬¦çš„ç±»å‹ï¼Œå…¶æœ€ç»ˆä¼šè¢«ç¼–è¯‘æˆä¸€ä¸ªcè¯­è¨€çš„unionã€‚è¿™é‡Œå®šä¹‰äº†ä¸€ä¸ªint ç±»å‹çš„int_value å’Œ doubleç±»å‹çš„double_valueã€‚<br/>
<code>%token</code>å¼€å¤´çš„è¡Œæ˜¯Tokençš„å£°æ˜ï¼Œæ‰€æœ‰ç”¨åˆ°çš„Tokenç±»å‹éƒ½åœ¨è¿™é‡Œå®šä¹‰ã€‚å¯¹äº<code>ADD</code> <code>SUB</code> <code>MUL</code> <code>DIV</code> <code>CR</code>ç­‰è®°å·åªéœ€è¦åŒ…å«å…¶ç±»å‹å³å¯ï¼Œè€Œå¯¹äºå€¼ä¸º<code>DOUBLE_LITERAL</code>çš„Tokenï¼Œå…¶ç±»å‹è¢«æŒ‡å®šä¸º<code>&lt;double_value&gt;</code>ï¼Œè¿™é‡Œçš„double_valueæ­£æ˜¯æ¥è‡ªäºå‰é¢å£°æ˜çš„unionä¸­çš„æˆå‘˜ä¹‹ä¸€ã€‚<br/>
<code>%%</code>åŒ…è£¹çš„éƒ¨åˆ†å«åšè§„åˆ™åŒºå—ï¼Œç”±è¯­æ³•è§„åˆ™å’ŒCè¯­è¨€ç¼–å†™çš„ç›¸åº”çš„è¡Œä¸ºä¸¤éƒ¨åˆ†æ„æˆã€‚åœ¨yaccä¸­ä½¿ç”¨äº†ç±»ä¼¼äºBNFèŒƒå¼æ¥ç¼–å†™è¯­æ³•è§„åˆ™ã€‚ç”±äºä½¿ç”¨äº†è‡ªç„¶è¯­è¨€ä½œä¸ºæ ‡è®°ï¼Œç†è§£ä¸Šè¿˜æ˜¯å¾ˆå®¹æ˜“çš„ã€‚ä¸‹é¢ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼š</p>

<pre><code class="language-c">line_list                 /* å¤šè¡Œè§„åˆ™ */
    : line                  /* å•è¡Œ */
    | line_list line        /* æˆ–è€…å¤šè¡Œåè·Ÿå•è¡Œ */
;
line                       /* å•è¡Œ */
    : expression CR          /* è¡¨è¾¾å¼åè·Ÿæ¢è¡Œç¬¦ */
;
expression                 /* è¡¨è¾¾å¼ */
    : term                   /* å’Œé¡¹ */
    | expression ADD term    /* æˆ–è€…è¡¨è¾¾å¼åŠ ä¸Šå’Œé¡¹ */
    {                        /* åŒ¹é…åæ‰§è¡Œçš„action */
        $$ = $1 + $3;
    }
    | expression SUB term    /* æˆ–è€…è¡¨è¾¾å¼å‡å»å’Œé¡¹ */
    {                        /* åŒ¹é…åæ‰§è¡Œçš„action */
        $$ = $1 - $3;
    }
;
term                        /* å’Œé¡¹ */
    : primary_expression      /* ä¸€å…ƒè¡¨è¾¾å¼ */
    | term MUL primary_expression /* æˆ–è€…å’Œé¡¹ä¹˜ä»¥ä¸€å…ƒè¡¨è¾¾å¼ */
    {                          /* åŒ¹é…åæ‰§è¡Œçš„action */
        $$ = $1 * $3;
    }                          
    | term DIV primary_expression /* æˆ–è€…å’Œé¡¹é™¤ä»¥ä¸€å…ƒè¡¨è¾¾å¼ */
    {                             /* åŒ¹é…åæ‰§è¡Œçš„action */
        $$ = $1 / $3;
    }
;
primary_expression          /* ä¸€å…ƒè¡¨è¾¾å¼ */
    : DOUBLE_LITERAL          /* å®æ•°å­—é¢é‡ */
;
</code></pre>

<p>å†™å¥½äº†è§„åˆ™ï¼Œé‚£ä¹ˆå°±æ¥ç¼–è¯‘è¿è¡Œ</p>

<pre><code class="language-bash">yacc -dv foo.y
flex foo.l
gcc -std=c99 -Wall -g -o foo y.tab.c lex.yy.c
</code></pre>

<p>è¿™æ ·å°±ç”Ÿæˆäº†<code>foo</code>è¿™ä¸ªå¯æ‰§è¡Œæ–‡ä»¶<br/>
è¿è¡Œfoo</p>

<pre><code class="language-bash">liubang@venux:~/workspace/c/my_lang/lex$ make run
1 + 3
&gt;&gt;4.000000
1/2 
&gt;&gt;0.500000
4 * 5
&gt;&gt;20.000000
</code></pre>

<p>å½“ç„¶æˆ‘ä¸ªäººåœ¨å¼€å‘cç¨‹åºçš„æ—¶å€™åå‘äºä½¿ç”¨makeå·¥å…·æ¥ç¼–è¯‘ä»£ç ï¼Œè¿™æ ·ä¼šå¾ˆæ–¹ä¾¿ã€‚ä¸‹é¢æ˜¯æˆ‘çš„Makefileæ–‡ä»¶:</p>

<pre><code class="language-makefile">CFLAGS = -O2 -g -Wall -std=c99
EXEC = foo
OBJS =  y.tab.o \
    lex.yy.o


%.c:
    yacc -dv foo.y
    lex foo.l

%.o: %.c
     $(CC) $(CFLAGS) -o $@ -c $&lt;

$(EXEC): $(OBJS)
    $(CC) $(OBJS) -o $@

all: $(EXEC)

run: $(EXEC)
    @./$(EXEC)

clean:
    $(RM) $(OBJS) $(EXEC)
</code></pre>

<p>åªéœ€è¦æ‰§è¡Œ<code>make run</code>å‘½ä»¤å³å¯è¿è¡Œï¼</p>

<h2 id="toc_5">é™„åŠ </h2>

<p>å¯èƒ½æœ‰äººä¼šç–‘æƒ‘ï¼Œè¿™ç©æ„å­¦ç€æœ‰ä»€ä¹ˆç”¨ï¼Œé‚£ä¹ˆæœ‰å…´è¶£çš„ä½ å¯ä»¥ä¸‹è½½ä¸€ä»½PHPçš„æºä»£ç ï¼Œåœ¨Zend(Zendå¼•æ“æ ¸å¿ƒæ–‡ä»¶)ç›®å½•ä¸­ä½ ä¸éš¾æ‰¾åˆ°<code>zend_language_scanner.l</code>,<code>zend_ini_scanner.l</code>,<code>zend_ini_parser.y</code>,<code>zend_language_parser.y</code>è¿™å‡ ä¸ªæ–‡ä»¶ï¼Œæ‰“å¼€å…¶å†…å®¹ï¼Œæ˜¯ä¸æ˜¯ä¸å†é‚£ä¹ˆææƒ§å’Œé™Œç”Ÿäº†å‘¢ã€‚</p>

<h2 id="toc_6">Summary</h2>

<p>æœ¬æ–‡åªæ˜¯åˆæ­¥ä»‹ç»yacc/lexå·¥å…·ç”Ÿæˆè¯æ³•è§£æå™¨å’Œè¯­æ³•è§£æå™¨çš„æœ€åŸºæœ¬ç”¨æ³•ï¼Œæ²¡æœ‰å¤ªå¤šçš„é˜è¿°è¯æ³•è§£æçš„åŸç†å’Œè¿‡ç¨‹ï¼Œæ‰€ä»¥æ›´åå®è·µï¼Œå†ç”±äºæœ¬äººæ¯•ä¸šä¸€å¹´å¤šå®åœ¨å¾ˆä¹…æ²¡å†™æ–‡ç« äº†ï¼Œå¸¸å¸¸ä¼šæç¬”ä¸çŸ¥ä»ä½•è¯´èµ·ï¼Œæ‰€ä»¥å†™èµ·æ¥å¾ˆæ…¢ï¼ŒåŠ ä¹‹ç™½å¤©è¦å·¥ä½œï¼Œæ—¶é—´è¾ƒç´§ï¼Œæ‰€ä»¥ä»Šå¤©å°±åˆ°è¿™é‡Œäº†ï¼Œè‡³äºç†è®ºçš„é˜è¿°ï¼Œéœ€è¦æ—¶é—´æ¥æ…¢æ…¢é…é…¿ğŸ˜‚ï¼</p>


    

      </div>

      <div class="row">
        <div class="large-6 columns">
        <p class="text-left" style="padding:15px 0px;">
      
          <a href="14778165360835.html" 
          title="Previous Post: è¯æ³•è§£æå’Œè¯­æ³•è§£æåŸç†åˆ†æä»¥åŠçº¯æ‰‹å·¥å®ç°">&laquo; è¯æ³•è§£æå’Œè¯­æ³•è§£æåŸç†åˆ†æä»¥åŠçº¯æ‰‹å·¥å®ç°</a>
      
        </p>
        </div>
        <div class="large-6 columns">
      <p class="text-right" style="padding:15px 0px;">
      
          <a  href="14771244487868.html" 
          title="Next Post: An Introduction to Lock-Free Programming">An Introduction to Lock-Free Programming &raquo;</a>
      
      </p>
        </div>
      </div>
      <div class="comments-wrap">
        <div class="share-comments">
          <div class="bdsharebuttonbox"><a href="#" class="bds_more" data-cmd="more"></a><a href="#" class="bds_qzone" data-cmd="qzone" title="åˆ†äº«åˆ°QQç©ºé—´"></a><a href="#" class="bds_tsina" data-cmd="tsina" title="åˆ†äº«åˆ°æ–°æµªå¾®åš"></a><a href="#" class="bds_tqq" data-cmd="tqq" title="åˆ†äº«åˆ°è…¾è®¯å¾®åš"></a><a href="#" class="bds_renren" data-cmd="renren" title="åˆ†äº«åˆ°äººäººç½‘"></a><a href="#" class="bds_weixin" data-cmd="weixin" title="åˆ†äº«åˆ°å¾®ä¿¡"></a></div>
<script>window._bd_share_config={"common":{"bdSnsKey":{"tqq":"sdsf","t163":"fdsg","tsohu":"gda"},"bdText":"gdg","bdMini":"2","bdMiniList":false,"bdPic":"dga","bdStyle":"1","bdSize":"32"},"share":{},"image":{"viewList":["qzone","tsina","tqq","renren","weixin"],"viewText":"åˆ†äº«åˆ°ï¼š","viewSize":"16"}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>

<!-- å¤šè¯´è¯„è®ºæ¡† start -->
    <div class="ds-thread" data-thread-key="" data-title="" data-url=""></div>
<!-- å¤šè¯´è¯„è®ºæ¡† end -->
<!-- å¤šè¯´å…¬å…±JSä»£ç  start (ä¸€ä¸ªç½‘é¡µåªéœ€æ’å…¥ä¸€æ¬¡) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"iliubang"};
    (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] 
         || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
    </script>
<!-- å¤šè¯´å…¬å…±JSä»£ç  end -->


          

          
        </div>
      </div>
    </div><!-- article-wrap -->
  </div><!-- large 8 -->




 <div class="large-4 medium-4 columns">
  <div class="hide-for-small">
    <div id="sidebar" class="sidebar">
          <div id="site-info" class="site-info">
            
                <div class="site-a-logo"><img src="asset/img/icon.jpg" /></div>
            
                <h1>åˆ˜é‚¦çš„åšå®¢</h1>
                <div class="site-des">åˆ˜é‚¦çš„åšå®¢</div>
                <div class="social">







<a target="_blank" class="weibo" href="http://weibo.com/AdolphLiu001 " title="weibo">Weibo</a>
<a target="_blank" class="twitter" target="_blank" href="https://twitter.com/iliubang" title="Twitter">Twitter</a>
<a target="_blank" class="github" target="_blank" href="https://github.com/iliubang" title="GitHub">GitHub</a>
<a target="_blank" class="email" href="mailto:it.liubang@qq.com" title="Email">Email</a>
  <a target="_blank" class="rss" href="atom.xml" title="RSS">RSS</a>
                
              	 </div>
          	</div>

             

              <div id="site-categories" class="side-item ">
                <div class="side-header">
                  <h2>Categories</h2>
                </div>
                <div class="side-content">

      	<p class="cat-list">
        
            <a href="PHP.html"><strong>PHP</strong></a>
        
            <a href="OS.html"><strong>OS</strong></a>
        
            <a href="C.html"><strong>C</strong></a>
        
            <a href="Java.html"><strong>Java</strong></a>
         
        </p>


                </div>
              </div>

              <div id="site-categories" class="side-item">
                <div class="side-header">
                  <h2>Recent Posts</h2>
                </div>
                <div class="side-content">
                <ul class="posts-list">
	      
		      
			      <li class="post">
			        <a href="14803466591982.html">Javaä¸­çš„æ„é€ ä»£ç å—å’Œé™æ€ä»£ç å—</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="14778165360835.html">è¯æ³•è§£æå’Œè¯­æ³•è§£æåŸç†åˆ†æä»¥åŠçº¯æ‰‹å·¥å®ç°</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="14775733948936.html">åŸºäºCè¯­è¨€çš„ç¼–ç¨‹è¯­è¨€å¼€å‘ -- yacc/lexåˆæ­¥</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="14771244487868.html">An Introduction to Lock-Free Programming</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="14770594324221.html">this is my test blog</a>
			      </li>
		     
		   
		  		</ul>
                </div>
              </div>
        </div><!-- sidebar -->
      </div><!-- hide for small -->
</div><!-- large 4 -->

</div><!-- row -->

 <div class="page-bottom clearfix">
  <div class="row">
   <p class="copyright">Copyright &copy; 2015
Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a>,&nbsp; 
Theme used <a target="_blank" href="http://github.com">GitHub CSS</a>.</p>
  </div>
</div>

        </section>
      </div>
    </div>

  
    

    <script src="asset/js/foundation.min.js"></script>
    <script>
      $(document).foundation();
      function fixSidebarHeight(){
        var w1 = $('.markdown-body').height();
          var w2 = $('#sidebar').height();
          if (w1 > w2) { $('#sidebar').height(w1); };
      }
      $(function(){
        fixSidebarHeight();
      })
      $(window).load(function(){
          fixSidebarHeight();
      });
     
    </script>

    <script src="asset/chart/all-min.js"></script><script type="text/javascript">$(function(){    var mwebii=0;    var mwebChartEleId = 'mweb-chart-ele-';    $('pre>code').each(function(){        mwebii++;        var eleiid = mwebChartEleId+mwebii;        if($(this).hasClass('language-sequence')){            var ele = $(this).addClass('nohighlight').parent();            $('<div id="'+eleiid+'"></div>').insertAfter(ele);            ele.hide();            var diagram = Diagram.parse($(this).text());            diagram.drawSVG(eleiid,{theme: 'simple'});        }else if($(this).hasClass('language-flow')){            var ele = $(this).addClass('nohighlight').parent();            $('<div id="'+eleiid+'"></div>').insertAfter(ele);            ele.hide();            var diagram = flowchart.parse($(this).text());            diagram.drawSVG(eleiid);        }    });});</script>
<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({TeX: { equationNumbers: { autoNumber: "AMS" } }});</script>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?d9426b8b196111b4af56f34a6e45d32a";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>


  </body>
</html>
