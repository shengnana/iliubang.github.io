---
layout: post
title: c++编程之指针，引用和内存动态分配 
author: 刘邦
excerpt: "c++编程之指针，引用和内存动态分配"
date: "2018-02-23"
catalog: true
tags: [c++]
category: c++
comments: true
---

原文地址:[https://www.ntu.edu.sg/home/ehchua/programming/cpp/cp4_PointerReference.html](https://www.ntu.edu.sg/home/ehchua/programming/cpp/cp4_PointerReference.html)

指针，引用和动态分配内存是C/C++语言中最强大的特性，这些特性使得程序员能够直接操作计算机中最关键和珍贵的记忆体，从而达到最大性能和高效的使用。
然而指针也是一把双刃剑，它也是C/C++编程语言中最复杂和最难的特性。

指针之所以这么强大，是因为它允许你通过地址来访问和操作对应记忆体中存储的内容。但是指针也很难被驾驭，使用好的话确实能够大大提升性能，而用的
不好的话，也会导致很多问题，例如著名的内存泄漏和缓冲区溢出，这些bug能导致系统发生紊乱。一些新的编程语言（例如Java和C#），将指针从它的语法
中去掉，通过提供自动内存管理的方式避免使用指针导致的许多问题。

虽然你在编写C/C++代码的时候可以不使用指针，但是在学习C/C++的时候很难不提及指针。指针也许不是为新手和笨蛋而设计的。


# 1. 指针变量

计算机记忆体位置有一个地址，对应地址处保存数据。记忆体地址通常是一个数字（一般用十六进制表示），这个数字很难被程序员直接使用。通常一个地址位置
的容量是8-bit（也就是1-byte），里面可以存储整数，实数，字符或者字符串，这完全取决于程序员如何解析。

为了减轻程序员使用数字地址和解析数据的负担，早期的编程语言（例如C语言）中产生了一种新的变量——这种变量是一个被命名了的变量的位置，它可以存储一个特定类型的值。
取代数字地址的是用名字（或者标识符）直接关联到确定的地址上，而且变量类型（如`int`, `double`, `char`）与之关联，从而简化了对数据的解析。

每个内存地址占8位（也就是1个字节），一个4个字节的`int`值需要4个内存位置。一个32位的系统通常使用32位的地址。同样的，存储这个32位的地址也需要4个内存位置。

下面的插图形象的描绘了计算机内存地址，内存中数据，变量名，变量类型以及变量值之间的关系。

![](/img/2018-02-23/MemoryAddressContent.png)

## 1.1 指针变量

指针变量（简称指针）基本上跟其他变量一样，都可以用来存放数据，但是跟普通变量不同的是，普通变量存储的是数值，而指针存放的是内存地址。

## 1.2 申明指针

指针在使用前必须先申明。申明指针的语法是在指针名前加上一个`*`符号。指针必须跟类型关联。

```cpp
type *ptr;
// or
type* ptr;
// or
type * ptr;
```

例如：

```cpp
int * iPtr;
double *dPtr;
```

需要注意的是，`*`必须放在指针变量名前面，一个`*`只作用于跟在它后面的指针变量名。`*`在申明语句中不是一个操作符，仅仅表明跟在它后门的变量是一个指针变量。

例如：

```cpp
int *p1, *p2, i;
int* p1, p2, i;
int * p1, * p2, i;
```

指针变量名的命名规则：用"p"或者"ptr"作为前缀或后缀。

## 1.3 使用取址操作符(&)初始化指针

当你申明一个指针的时候，它并没有被初始化。也就是说，它指向一个不确定的非法地址，这是很危险的。你需要通过给它赋值为一个合法地址来对它进行初始化，而要完成这一
操作，需要使用取值操作符(&)。

